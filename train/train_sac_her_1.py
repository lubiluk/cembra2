#!/usr/bin/env python3

from algos import sac_her
import torch as th
import gym
import gym_pepper


recorded_actions = [
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, -1.5, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
    [0.01, -1.0, 0, 0, 0, 0, 0, 0, 0.0, 0, 1.0],
]


# For debugging only
# envs = iter([
#     gym.make('PepperPush-v0', sim_steps_per_action=10, gui=True),
#     gym.make('PepperPush-v0', sim_steps_per_action=10)
# ])


# def env_fn(): 
#     return next(envs)

def env_fn():
    return gym.make('PepperPush-v0', sim_steps_per_action=10)

ac_kwargs = dict(hidden_sizes=[128, 128, 128], activation=th.nn.ReLU)

logger_kwargs = dict(
    output_dir='data/pepper_push_sac_her_1',
    exp_name='pepper_push_sac_her_1')

sac_her(
    env_fn=env_fn,
    ac_kwargs=ac_kwargs,
    steps_per_epoch=15000,
    max_ep_len=300,
    epochs=200,
    batch_size=256,
    replay_size=1000000,
    gamma=0.95,
    lr=0.001,
    update_after=1000,
    update_every=1,
    num_additional_goals=4,
    goal_selection_strategy='future',
    logger_kwargs=logger_kwargs,
    demo_actions=recorded_actions,
    demo_actions_repeat=10000)
